apiVersion: grizzly.grafana.com/v1alpha1
kind: Dashboard
metadata:
    folder: integration-blackbox-exporter
    name: blackbox-exporter-overview
spec:
    annotations:
        list:
            - builtIn: 1
              datasource:
                type: grafana
                uid: -- Grafana --
              enable: true
              hide: true
              iconColor: rgba(0, 211, 255, 1)
              name: Annotations & Alerts
              type: dashboard
    editable: true
    fiscalYearStartMonth: 0
    graphTooltip: 1
    links: []
    panels:
        - datasource:
            type: prometheus
            uid: ${DS_PROMETHEUS}
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: red
                          value: null
                        - color: orange
                          value: 95
                        - color: green
                          value: 99
                unit: percent
            overrides: []
          gridPos:
            h: 4
            w: 5
            x: 0
            "y": 0
          id: 1
          options:
            colorMode: background
            graphMode: none
            justifyMode: auto
            orientation: auto
            percentChangeColorMode: standard
            reduceOptions:
                calcs:
                    - lastNotNull
                fields: ""
                values: false
            showPercentChange: false
            textMode: auto
            wideLayout: true
          pluginVersion: 11.5.2
          targets:
            - datasource:
                type: prometheus
                uid: ${DS_PROMETHEUS}
              editorMode: code
              expr: avg(probe_success{service="duplo-blackbox-exporter"}) * 100
              range: true
              refId: A
          title: Global Uptime
          type: stat
        - datasource:
            type: prometheus
            uid: duplo-metrics
          fieldConfig:
            defaults:
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 80
            overrides: []
          gridPos:
            h: 4
            w: 5
            x: 5
            "y": 0
          id: 25
          options:
            colorMode: background
            graphMode: none
            justifyMode: auto
            orientation: auto
            percentChangeColorMode: standard
            reduceOptions:
                calcs:
                    - lastNotNull
                fields: ""
                values: false
            showPercentChange: false
            textMode: value
            wideLayout: true
          pluginVersion: 11.5.2
          targets:
            - editorMode: code
              expr: count(probe_success{service="duplo-blackbox-exporter"})
              range: true
              refId: A
          title: Total Targets
          type: stat
        - datasource:
            uid: duplo-metrics
          fieldConfig:
            defaults:
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 80
            overrides: []
          gridPos:
            h: 4
            w: 5
            x: 10
            "y": 0
          id: 26
          options:
            colorMode: background
            graphMode: none
            justifyMode: auto
            orientation: auto
            percentChangeColorMode: standard
            reduceOptions:
                calcs:
                    - lastNotNull
                fields: ""
                values: false
            showPercentChange: false
            textMode: value
            wideLayout: true
          pluginVersion: 11.5.2
          targets:
            - editorMode: code
              expr: count(probe_success{service="duplo-blackbox-exporter"} == 1)
              range: true
              refId: A
          title: Healthy Targets
          type: stat
        - datasource:
            type: prometheus
            uid: ${DS_PROMETHEUS}
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: red
                          value: 1
            overrides: []
          gridPos:
            h: 4
            w: 5
            x: 15
            "y": 0
          id: 2
          options:
            colorMode: background
            graphMode: none
            justifyMode: auto
            orientation: auto
            percentChangeColorMode: standard
            reduceOptions:
                calcs:
                    - lastNotNull
                fields: ""
                values: false
            showPercentChange: false
            textMode: value
            wideLayout: true
          pluginVersion: 11.5.2
          targets:
            - datasource:
                type: prometheus
                uid: ${DS_PROMETHEUS}
              editorMode: code
              expr: count(probe_success{service="duplo-blackbox-exporter"} == 0)
              legendFormat: Targets Down
              range: true
              refId: A
          title: Critical Failures
          type: stat
        - datasource:
            type: prometheus
            uid: ${DS_PROMETHEUS}
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
                        - color: orange
                          value: 0.5
                        - color: red
                          value: 1
                unit: s
            overrides: []
          gridPos:
            h: 4
            w: 4
            x: 20
            "y": 0
          id: 3
          options:
            colorMode: value
            graphMode: area
            justifyMode: auto
            orientation: auto
            percentChangeColorMode: standard
            reduceOptions:
                calcs:
                    - mean
                fields: ""
                values: false
            showPercentChange: false
            textMode: auto
            wideLayout: true
          pluginVersion: 11.5.2
          targets:
            - datasource:
                type: prometheus
                uid: ${DS_PROMETHEUS}
              editorMode: code
              expr: avg(probe_duration_seconds{service="duplo-blackbox-exporter"})
              range: true
              refId: A
          title: Average Latency
          type: stat
        - datasource:
            type: prometheus
            uid: duplo-metrics
          description: ""
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: left
                    cellOptions:
                        type: auto
                    filterable: true
                    inspect: false
                mappings: []
                min: 0
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                          value: null
            overrides:
                - matcher:
                    id: byName
                    options: SSL Cert Expiry (days)
                  properties:
                    - id: decimals
                      value: 0
                    - id: thresholds
                      value:
                        mode: absolute
                        steps:
                            - color: rgba(0, 0, 0, 0)
                              value: null
                            - color: red
                              value: 0
                            - color: orange
                              value: 1
                            - color: yellow
                              value: 7
                            - color: green
                              value: 24
                    - id: custom.cellOptions
                      value:
                        mode: basic
                        type: gauge
                    - id: min
                      value: 0
                    - id: max
                      value: 365
                    - id: custom.filterable
                      value: false
                    - id: custom.width
                      value: 176
                - matcher:
                    id: byName
                    options: Status
                  properties:
                    - id: mappings
                      value:
                        - options:
                            "0":
                                text: DOWN
                            "1":
                                text: UP
                          type: value
                    - id: thresholds
                      value:
                        mode: absolute
                        steps:
                            - color: red
                              value: null
                            - color: green
                              value: 1
                    - id: custom.cellOptions
                      value:
                        mode: gradient
                        type: color-background
                    - id: custom.width
                      value: 80
                - matcher:
                    id: byName
                    options: Code
                  properties:
                    - id: thresholds
                      value:
                        mode: absolute
                        steps:
                            - color: rgba(0, 0, 0, 0)
                              value: null
                            - color: green
                              value: 200
                            - color: yellow
                              value: 300
                            - color: super-light-red
                              value: 400
                            - color: dark-red
                              value: 500
                    - id: custom.cellOptions
                      value:
                        applyToRow: false
                        type: color-background
                        wrapText: false
                    - id: mappings
                      value:
                        - options:
                            "0":
                                text: ""
                          type: value
                    - id: custom.width
                      value: 72
                - matcher:
                    id: byName
                    options: SSL
                  properties:
                    - id: mappings
                      value:
                        - options:
                            "0":
                                text: "NO"
                            "1":
                                text: OK
                          type: value
                    - id: thresholds
                      value:
                        mode: absolute
                        steps:
                            - color: rgba(3, 3, 3, 0)
                              value: null
                            - color: red
                              value: 0
                            - color: green
                              value: 1
                    - id: custom.cellOptions
                      value:
                        mode: gradient
                        type: color-background
                    - id: custom.width
                      value: 64
                - matcher:
                    id: byName
                    options: Probe Duration (s)
                  properties:
                    - id: thresholds
                      value:
                        mode: absolute
                        steps:
                            - color: green
                              value: null
                            - color: yellow
                              value: 0.8
                            - color: red
                              value: 2
                    - id: custom.cellOptions
                      value:
                        mode: basic
                        type: gauge
                    - id: custom.filterable
                      value: false
                    - id: decimals
                      value: 2
                    - id: max
                      value: 3
                    - id: custom.width
                      value: 155
                - matcher:
                    id: byName
                    options: DNS Lookup Duration (s)
                  properties:
                    - id: thresholds
                      value:
                        mode: absolute
                        steps:
                            - color: green
                              value: null
                            - color: yellow
                              value: 0.1
                            - color: red
                              value: 0.2
                    - id: max
                      value: 0.3
                    - id: custom.cellOptions
                      value:
                        mode: basic
                        type: gauge
                    - id: custom.filterable
                      value: false
                    - id: decimals
                      value: 3
                - matcher:
                    id: byName
                    options: Instance
                  properties:
                    - id: links
                      value:
                        - targetBlank: true
                          title: ${__data.fields.Instance}
                          url: /d/blackbox-exporter-details/blackbox-exporter-details?var-DS_PROMETHEUS=duplo-metrics&var-job=${job}&var-target=${__data.fields.Instance}
                    - id: custom.width
                      value: 521
                - matcher:
                    id: byName
                    options: TLS Version
                  properties:
                    - id: custom.width
                      value: 121
          gridPos:
            h: 18
            w: 24
            x: 0
            "y": 4
          id: 27
          options:
            cellHeight: sm
            footer:
                countRows: false
                fields: ""
                reducer:
                    - sum
                show: false
            showHeader: true
            sortBy:
                - desc: false
                  displayName: SSL Cert Expiry (days)
          pluginVersion: 11.5.2
          targets:
            - datasource:
                type: prometheus
                uid: duplo-metrics
              editorMode: code
              expr: probe_success{job=~"$job", instance=~"$target"}
              format: table
              instant: true
              interval: ""
              legendFormat: ""
              refId: A
            - datasource:
                type: prometheus
                uid: duplo-metrics
              editorMode: code
              expr: probe_http_ssl{job=~"$job", instance=~"$target"} > 0
              format: table
              instant: true
              interval: ""
              legendFormat: ""
              refId: B
            - datasource:
                type: prometheus
                uid: duplo-metrics
              editorMode: code
              expr: (probe_ssl_earliest_cert_expiry{job=~"$job", instance=~"$target"} - time()) / 3600 / 24
              format: table
              instant: true
              interval: ""
              legendFormat: ""
              refId: C
            - datasource:
                type: prometheus
                uid: duplo-metrics
              editorMode: code
              expr: probe_http_status_code{job=~"$job", instance=~"$target"} > 0
              format: table
              instant: true
              interval: ""
              legendFormat: ""
              refId: D
            - datasource:
                type: prometheus
                uid: duplo-metrics
              editorMode: code
              expr: avg_over_time(probe_duration_seconds{job=~"$job", instance=~"$target"}[1m])
              format: table
              hide: false
              instant: false
              interval: ""
              intervalFactor: 1
              legendFormat: ""
              refId: E
            - datasource:
                type: prometheus
                uid: duplo-metrics
              editorMode: code
              expr: probe_tls_version_info{job=~"$job", instance=~"$target"}
              format: table
              instant: true
              interval: ""
              legendFormat: ""
              refId: F
            - datasource:
                type: prometheus
                uid: duplo-metrics
              editorMode: code
              expr: avg_over_time(probe_dns_lookup_time_seconds{job=~"$job", instance=~"$target"}[1m])
              format: table
              instant: true
              interval: ""
              legendFormat: ""
              refId: G
          title: HTTP Probe Overview
          transformations:
            - id: seriesToColumns
              options:
                byField: instance
            - id: organize
              options:
                excludeByName:
                    __name__: true
                    __name__ 1: true
                    __name__ 2: true
                    __name__ 3: true
                    __name__ 4: true
                    __name__ 5: true
                    __name__ 6: true
                    __name__ 7: true
                    Time: true
                    Time 1: true
                    Time 2: true
                    Time 3: true
                    Time 4: true
                    Time 5: true
                    Time 6: true
                    Time 7: true
                    Time 8: true
                    Value: false
                    'Value #A': false
                    'Value #B': false
                    'Value #F': true
                    cluster 1: true
                    cluster 2: true
                    cluster 3: true
                    cluster 4: true
                    cluster 5: true
                    cluster 6: true
                    cluster 7: true
                    container 1: true
                    container 2: true
                    container 3: true
                    container 4: true
                    container 5: true
                    container 6: true
                    container 7: true
                    endpoint 1: true
                    endpoint 2: true
                    endpoint 3: true
                    endpoint 4: true
                    endpoint 5: true
                    endpoint 6: true
                    endpoint 7: true
                    job: true
                    job 1: true
                    job 2: true
                    job 3: true
                    job 4: true
                    job 5: true
                    job 6: true
                    job 7: true
                    job 8: true
                    namespace 1: true
                    namespace 2: true
                    namespace 3: true
                    namespace 4: true
                    namespace 5: true
                    namespace 6: true
                    namespace 7: true
                    phase: true
                    pod 1: true
                    pod 2: true
                    pod 3: true
                    pod 4: true
                    pod 5: true
                    pod 6: true
                    pod 7: true
                    service 1: true
                    service 2: true
                    service 3: true
                    service 4: true
                    service 5: true
                    service 6: true
                    service 7: true
                    type: true
                    type 1: true
                    type 2: true
                    type 3: true
                    type 4: true
                    type 5: true
                    type 6: true
                    type 7: true
                    type 8: true
                    version: false
                includeByName: {}
                indexByName:
                    __name__ 1: 10
                    __name__ 2: 14
                    __name__ 3: 21
                    __name__ 4: 25
                    __name__ 5: 29
                    Time 1: 9
                    Time 2: 13
                    Time 3: 17
                    Time 4: 20
                    Time 5: 24
                    Time 6: 28
                    Time 7: 32
                    'Value #A': 1
                    'Value #B': 3
                    'Value #C': 5
                    'Value #D': 2
                    'Value #E': 6
                    'Value #F': 8
                    'Value #G': 7
                    instance: 0
                    job 1: 11
                    job 2: 15
                    job 3: 18
                    job 4: 22
                    job 5: 26
                    job 6: 30
                    type 1: 12
                    type 2: 16
                    type 3: 19
                    type 4: 23
                    type 5: 27
                    type 6: 31
                    version: 4
                renameByName:
                    Value: Up
                    'Value #A': Status
                    'Value #B': SSL
                    'Value #C': SSL Cert Expiry (days)
                    'Value #D': Code
                    'Value #E': Probe Duration (s)
                    'Value #F': ""
                    'Value #G': DNS Lookup Duration (s)
                    'Value #H': Probe IP
                    instance: Instance
                    type 6: ""
                    version: TLS Version
          transparent: true
          type: table
    preload: false
    refresh: ""
    schemaVersion: 40
    tags:
        - blackbox
        - overview
    templating:
        list:
            - current:
                text: duplo-metrics
                value: duplo-metrics
              includeAll: false
              label: Datasource
              name: DS_PROMETHEUS
              options: []
              query: prometheus
              refresh: 1
              regex: ""
              type: datasource
            - current:
                text: prometheus-blackbox-exporter-1762516080
                value: prometheus-blackbox-exporter-1762516080
              datasource:
                type: prometheus
                uid: ${DS_PROMETHEUS}
              definition: label_values(probe_success, job)
              hide: 2
              includeAll: false
              label: Job
              name: job
              options: []
              query:
                query: label_values(probe_success, job)
                refId: StandardVariableQuery
              refresh: 1
              regex: ""
              sort: 1
              type: query
            - current:
                text: All
                value:
                    - $__all
              datasource:
                type: prometheus
                uid: ${DS_PROMETHEUS}
              definition: label_values(probe_success{job="$job"}, instance)
              includeAll: true
              label: Target
              multi: true
              name: target
              options: []
              query:
                query: label_values(probe_success{job="$job"}, instance)
                refId: StandardVariableQuery
              refresh: 1
              regex: ""
              sort: 1
              type: query
    time:
        from: now-5m
        to: now
    title: Blackbox Exporter Overview
    uid: blackbox-exporter-overview